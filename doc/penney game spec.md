# Penney's Game 网页版 - 需求规格文档

## 项目概述

基于 Cloudflare Workers 构建的 Penney's Game 网页应用，提供可验证的公平随机数系统，支持 PC 和移动端自适应界面。

---

## 核心概念

### Penney's Game 规则
- 玩家选择一个3枚硬币的正反面序列（如"正正反"）
- 程序根据策略选择对应的序列
- 连续投掷硬币，谁选择的序列先出现则获胜一轮
- 从获胜序列之后的下一个硬币继续比赛，直到投掷次数用尽
- 统计双方各获胜多少轮

### 程序策略对照表

| 玩家选择 | 程序选择 |
|---------|---------|
| 正正正 | 反正正 |
| 正正反 | 反正正 |
| 正反正 | 正正反 |
| 正反反 | 正正反 |
| 反正正 | 反反正 |
| 反正反 | 反反正 |
| 反反正 | 正反反 |
| 反反反 | 正反反 |

---

## 技术方案

### 部署架构
- **平台**：Cloudflare Workers
- **类型**：纯静态托管（后续可扩展 API）
- **前端框架**：原生 HTML/CSS/JavaScript（单页应用）

### 随机数生成
- **算法**：Mulberry32
- **种子格式**：8位十六进制字符串（如 `A3B2C1D0`），大小写不敏感
- **种子来源**：基于 UUID/时间戳/随机数生成
- **种子管理**：
  - 游戏开始前可查看当前种子
  - 提供"刷新"按钮更换种子
  - 每局游戏使用独立种子

```javascript
// Mulberry32 实现
function mulberry32(seed) {
  return function() {
    let t = seed += 0x6D2B79F5;
    t = Math.imul(t ^ t >>> 15, t | 1);
    t ^= t + Math.imul(t ^ t >>> 7, t | 61);
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
  }
}
```

---

## 页面结构

采用**单页应用**设计，通过选项卡/抽屉切换不同功能区域。移动端支持左右滑动切换。

### 1. 游戏主页面

#### 游戏设置区
- **序列选择**：从8个预设选项中选择（显示中文：正/反）
- **投掷次数**：下拉选择 1000 / 5000 / 10000 次（默认 5000）
- **种子显示**：显示当前8位十六进制种子
- **刷新种子按钮**：点击更换新种子
- **查看种子详情链接**：跳转到种子验证页面

#### 程序序列揭示
- 玩家选择序列后，立即显示程序序列
- 揭示时播放"AI思考中"动画效果（约1-2秒）
- 揭示后显示"开始游戏"按钮

#### 游戏动画区
- **硬币样式**：拟真风格（金属质感、光影效果）
- **硬币翻转**：沿垂直轴（左右翻）
- **序列展示**：硬币从右侧滑入，形成类似进度条效果
- **显示数量**：根据浏览器宽度自适应
- **旧硬币处理**：被新硬币顶出左侧消失
- **颜色标识**：
  - 玩家方：蓝色
  - 程序方：红色
- **获胜高亮**：获胜序列的3枚硬币以对应颜色背景高亮，暂停展示后继续

#### 速度控制
- 1倍速（基准速度）
- 2倍速
- 3倍速
- 跳过动画直接看结果

#### 计分板
- 实时显示双方获胜次数
- 分数变化时有动画效果（数字跳动、+1飘字）

#### 结果页面
- 显示双方最终获胜次数
- "再来一局"按钮（保留投掷次数和玩家序列设置，仅换新种子）

---

### 2. 种子验证页面

#### 功能
- 输入任意符合格式的种子（8位十六进制）
- 实时校验种子格式有效性
- 从游戏页面可直接携带种子跳转至此页面

#### 序列展示
- 使用**虚拟滚动**技术渲染（只渲染可见区域）
- 完整显示选定投掷次数的所有硬币

#### 搜索功能
- 支持搜索特定序列（如"正反正"）
- 高亮所有匹配位置
- 显示"共找到 N 处匹配"统计

---

### 3. 历史记录页面

#### 列表视图
每条记录显示：
- 双方选择的序列
- 双方得分
- 最初若干个硬币预览

#### 详情/重放页面
- 显示完整游戏信息
- 所有硬币虚拟滚动展示（带获胜高亮效果）
- 无搜索功能
- 可跳转到种子验证页面

#### 存储规则
- 使用 localStorage 本地存储
- 最多保存 10 条记录
- 超出时自动删除最旧记录

#### 保存数据
- 种子
- 玩家序列
- 程序序列
- 双方获胜次数
- 投掷次数
- 游戏时间
- 每轮获胜的详细位置

---

### 4. 游戏规则弹窗

#### 触发条件
- 首次访问时自动弹出
- 界面上有常驻"游戏规则"入口可手动打开

#### 内容
- Penney's Game 简介
- 游戏玩法说明
- 公平性验证机制说明

---

## 界面设计

### 主题风格
- **色调**：浅色主题（亮色背景）
- **语言**：仅支持中文
- **响应式**：支持 PC 和移动端自适应

### 视觉元素
- **硬币**：拟真风格，金属质感，有正反面区分
- **玩家标识**：蓝色
- **程序标识**：红色

### 交互
- 无音效
- 无分享功能

---

## 边界情况处理

### 序列用尽
- 如果最后几次投掷无法决出胜负，该轮不计入统计

### 零分情况
- 如果投掷次数较少导致双方都是0分，正常显示结果

### 游戏中断
- 刷新页面或关闭浏览器不保存进度
- 下次访问重新开始

### 种子验证
- 实时校验输入格式
- 非法输入时显示错误提示

---

## 不包含的功能

- ❌ 音效
- ❌ 分享功能
- ❌ 多语言支持
- ❌ 深色主题
- ❌ 服务端统计
- ❌ 账号系统

---

## 文件结构设计（建议）

```
cf-penney-game/
├── wrangler.toml           # Cloudflare Workers 配置
├── src/
│   └── index.js            # Worker 入口（静态资源服务）
├── public/
│   ├── index.html          # 主页面
│   ├── css/
│   │   └── style.css       # 样式文件
│   ├── js/
│   │   ├── app.js          # 应用主逻辑
│   │   ├── game.js         # 游戏核心逻辑
│   │   ├── rng.js          # 随机数生成器
│   │   ├── animation.js    # 动画控制
│   │   ├── storage.js      # 本地存储管理
│   │   └── ui.js           # UI 组件
│   └── assets/
│       └── coin.svg        # 硬币图形资源
└── README.md
```

---

## 总结

本项目是一个纯前端实现的 Penney's Game，通过预公布的随机数种子保证公平性，用户可以随时验证完整的硬币序列。核心亮点包括：

1. **可验证的公平性**：种子公开，任何人可复现验证
2. **流畅的动画体验**：拟真硬币、实时计分、可调节播放速度
3. **完善的历史记录**：本地保存最近10局，支持重放查看
4. **响应式设计**：PC 和移动端均有良好体验
